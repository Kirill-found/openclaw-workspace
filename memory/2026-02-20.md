# 2026-02-20

## GeoReview — Работа за день

### Лидогенерация
- **Краснодар**: 13 фитнес-клубов собраны с контактами, рейтингами 2ГИС, описаниями
  - Данные: `fitness_leads.json`, `fitness_krasnodar.csv`
  - Google Sheets: `1Idp3pOo50cZqFPUhBniq8GWd0PbuY4ZOkgMfrmdENbc` (Лист1)
- **Москва**: 166 фитнес-клубов (World Class, Spirit, DDX + локальные)
  - 83 с рейтингом, 119 с телефоном, 0 с email
  - Данные: `fitness_moscow.json`, `fitness_moscow_raw.json`
  - Google Sheets: `11uaaUtRlLhoqds67ZaOFLaXjPCNexSUv3IcFiq4TLjY`
- **Проблема парсинга контактов**: SPA-сайты не парсятся через web_fetch. Решение: web_search + 2ГИС/Яндекс Карты сниппеты
- **Рассылка КП**: подготовлены письма для 3 клубов Краснодара (рейтинг ≥4.5): 50 Gym, Balance, Дом физкультурника. Ждём авторизацию gmail в gog.

### Админ-панель (доступ к коду виджета)
- Добавлены поля `role` и `can_embed` к users
- kirillpogorelyy20@gmail.com = admin
- Админ-панель: `/dashboard/admin/users` — управление доступом
- Код виджета заблюрен для юзеров без `can_embed` (на organizations/show)
- **Проблема с JS в Turbo**: inline scripts и внешние scripts через body не выполняются при Turbo navigation. Решение — чистая HTML form с `data-turbo="false"`
- Кнопка тогла переделана на обычную `<form>` без JS

### Виджет
- `align-items: start` добавлен в grid layout (карточки больше не растягиваются)
- Задеплоен widget.js

### Синхронизация отзывов — прогресс-бар
- Добавлен `/sync_ui.js` — AJAX синхронизация без перезагрузки
- Прогресс-бар с поллингом `sync_status` каждые 3 сек
- Endpoint `GET /dashboard/organizations/:id/sync_status` (JSON)
- `POST /sync` теперь respond_to json/html
- CSS спиннер вместо SVG стрелочек

### Лендинг
- Убрана секция тарифов (Pricing)
- Убрана секция статистики (1200+ виджетов и т.д.)
- FAQ обновлён — убраны упоминания тарифов

### Ключевые файлы изменены
- `app/models/user.rb` — role, can_embed
- `app/controllers/dashboard/admin/users_controller.rb` — NEW
- `app/views/dashboard/admin/users/index.html.erb` — NEW
- `app/controllers/dashboard/organizations_controller.rb` — sync_status, respond_to json
- `app/views/dashboard/organizations/show.html.erb` — прогресс-бар, блюр кода
- `app/views/layouts/dashboard.html.erb` — ссылка на админку
- `app/views/pages/home.html.erb` — убраны тарифы и статистика
- `public/sync_ui.js` — NEW
- `public/widget.js` — align-items: start
- `config/routes.rb` — admin/users, sync_status
- `db/migrate/20260220160000_add_role_and_can_embed_to_users.rb` — NEW

### gog авторизация
- kirillpogorelyy20@gmail.com авторизован для sheets
- Gmail scope ещё не добавлен — ждёт OAuth в браузере
