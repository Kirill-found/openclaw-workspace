# 2026-02-25 (среда)

## Le Nez — Парфюмерное приложение (Xcode)
**Путь проекта:** `/Users/karavan/Developer/Le Nez/`

### Архитектура
- **3-этапный pipeline:** GPT анализирует фото → поиск по curated DB → GPT выбирает из кандидатов
- **CuratedAnalysis.swift** — основной метод `analyzeVibeWithCuratedDB()`
- **OpenAIService.swift** — 4 режима: direct match, note-based, hybrid, curated DB
- **Модель:** GPT-4o, API ключ в Config.swift
- **CuratedPerfumeService.swift** — загружает curated_perfumes.json, индексирует по эстетикам
- **NoteSearchService.swift** — 26k ароматов с нотами (perfumes_with_notes.json)
- **PerfumeDatabase.swift** — 24k бутылок с картинками (bottles_labels.json)
- **ScentMatcher.swift** — legacy матчинг по аккордам (не используется в текущем flow)

### Проблема: одинаковые рекомендации
**Причина:** curated_perfumes.json содержал только 803 аромата. При фильтрации по аккордам+гендеру+картинкам оставался узкий пул → GPT выбирал одних и тех же.

### Решение: расширение базы 803 → 3303
- Написал скрипт `/Users/karavan/Developer/Le Nez/Data/expand_curated_db.py`
- Источники: fra_perfumes.csv (70k) + bottles_labels.json (24k) + perfumes_with_notes.json (26k)
- Маппинг 25 эстетик через правила accord→aesthetic
- Бренды извлекаются из URL Fragrantica (надёжнее чем из Name поля CSV)
- Ноты: приоритет NoteSearchService (26k verified), fallback на regex из описаний

### Аудит качества расширенной базы
- **Изображения:** 100% загружаются (HTTP HEAD проверка 20/20)
- **FragranticaID:** 0 несовпадений brand/name (200 проверок)
- **Пирамида нот:** 93% точность (было 65% до фикса через NoteSearchService)
- **Полнота:** 100% имеют top+heart+base ноты и аккорды
- **Размер:** 1.8 MB (оптимизировано для мобилки)

### TODO
- [ ] Заменить curated_perfumes.json в Resources на расширенную версию
- [ ] Добавить рандомизацию в Stage 2 (searchCuratedDB) — перемешивать кандидатов
- [ ] Трекать историю рекомендаций (исключать недавно показанные)
- [ ] Поднять temperature в Stage 3 с 0.7 до 0.85

### Данные Fragrantica в workspace
- `fragrantica/data/fra_perfumes.csv` — 70k ароматов
- `fragrantica/bottles_labels.json` — 24k с ID и картинками
- `fragrantica/scraper.py` — парсер страниц Fragrantica
- `fragrantica/data/fra_cleaned.csv` — очищенная версия

## Анализ "Голубого океана" для Кирилла
- Провёл анализ 5 B2C ниш + 5 SaaS ниш по методологии Blue Ocean Strategy
- Фокус: нижние уровни Маслоу (физиология, безопасность, принадлежность)
- Ключевой инсайт: не изобретать новые потребности, а новые способы закрывать старые

## Agent Feed
- Посты #73, #74, #75 опубликованы (голубые океаны, SaaS стратегии)
- API работает, авторизация через Bearer token
- Лимит 500 символов на пост
