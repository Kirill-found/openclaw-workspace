# 2026-02-11

## Le Nez - Perfume App Progress

### Fixed Today
- **ImageCache async disk loading** - no longer blocks main thread
- **Image loading throttling** - random delays (50-200ms for ingredients, 100-400ms for bottles)
- **IngredientImageProvider** - fixed IDs: fig leaf=150, wet stone=1390, added sea foam, baltic sea mist, calabrian bergamot
- **New loading animation** - Notion-style minimal: 3 breathing dots + thin progress line + clean typography
- **GPT prompt updated** - removed restrictive "verified list", GPT can now recommend any perfume
- **PerfumeDatabase lookup** - added prefix search to find "Tam Dao" ‚Üí "tam-dao-eau-de-parfum"

### Key Discovery: GPT Recommendation Problem
- GPT doesn't "search" - it generates based on training data popularity
- Popular perfumes (Tam Dao, BR540, Santal 33) appear more often simply because they're mentioned more online
- **Solution proposed**: Two-step approach:
  1. GPT outputs NOTES/ACCORDS (not perfume names)
  2. We search our database for perfumes matching those notes
  
### Fragrantica Parser
- Created `/Users/karavan/Developer/Le Nez/scripts/fragrantica_parser.py`
- Successfully parses: top/heart/base notes, rating, votes
- **Problem**: Got 429 (rate limited) after ~140 requests
- Increased delay to 6-12 sec between requests
- Progress saved: 52 perfumes with notes in `parser_progress.json`
- Output file: `Le Nez/Resources/perfumes_with_notes.json`

### Timly HR
- Confirmed uses `gpt-4o-mini` everywhere (not gpt-4o)
- `ai_code_executor.py` with gpt-4o exists but is DEAD CODE - never imported/used
- Le Nez uses `gpt-4o` for image analysis

### Files Modified
- `Le Nez/Services/ImageCache.swift` - async disk loading
- `Le Nez/Services/PerfumeDatabase.swift` - prefix search
- `Le Nez/Services/OpenAIService.swift` - new prompt without restrictions
- `Le Nez/Services/IngredientImageProvider.swift` - more ingredient IDs
- `Le Nez/Views/ScannerView.swift` - new Notion-style loading animation
- `Le Nez/Views/ResultView.swift` - async image loading
- `Le Nez/Views/FragrancePyramidView.swift` - async image loading

### Next Steps
- [x] ~~Fragrantica parser~~ ‚Äî –Ω–µ –Ω—É–∂–µ–Ω, —Ä–µ—à–∏–ª–∏ –∏–Ω–∞—á–µ

## üéâ –†–ï–®–ï–ù–û: –û–≥—Ä–∞–Ω–∏—á–∏–ª–∏ GPT –±—Ä–µ–Ω–¥–∞–º–∏ –∏–∑ –±–∞–∑—ã

### –ü—Ä–æ–±–ª–µ–º–∞
- GPT –∑–Ω–∞–ª 70k+ –∞—Ä–æ–º–∞—Ç–æ–≤, –Ω–∞—à–∞ –±–∞–∑–∞ = 24k
- –î–ª—è –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –∞—Ä–æ–º–∞—Ç–æ–≤ –Ω–µ –±—ã–ª–æ –∫–∞—Ä—Ç–∏–Ω–æ–∫ —Ñ–ª–∞–∫–æ–Ω–æ–≤

### –†–µ—à–µ–Ω–∏–µ
- –°–æ–∑–¥–∞–ª–∏ `available_brands.json` (1063 –±—Ä–µ–Ω–¥–∞)
- –ü–µ—Ä–µ–¥–∞—ë–º —Å–ø–∏—Å–æ–∫ –±—Ä–µ–Ω–¥–æ–≤ –≤ GPT –ø—Ä–æ–º–ø—Ç
- GPT —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç –¢–û–õ–¨–ö–û –∏–∑ —ç—Ç–∏—Ö –±—Ä–µ–Ω–¥–æ–≤
- **100% –ø–æ–ø–∞–¥–∞–Ω–∏–µ –ø–æ –∫–∞—Ä—Ç–∏–Ω–∫–∞–º!**

### –¢–∞–∫–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ —Å–µ–≥–æ–¥–Ω—è
- `normalize()` ‚Äî —Ç–µ–ø–µ—Ä—å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∞–∫—Ü–µ–Ω—Ç—ã (Herm√®s‚Üíhermes), –∞–ø–æ—Å—Ç—Ä–æ—Ñ—ã (d'Afrique‚Üíd-afrique)
- –ì–∏–±–∫–∏–π matching ‚Äî prefix search –¥–ª—è –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ (Aqua Universalis ‚Üí aqua-universalis-forte)
- –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ (–≤—Ä–µ–º–µ–Ω–Ω–æ, –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)
- Debug –ª–æ–≥–∏ –≤ PerfumeDatabase –∏ ResultView

### –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã
- `OpenAIService.swift` ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ –±—Ä–µ–Ω–¥–æ–≤ + –Ω–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç
- `PerfumeDatabase.swift` ‚Äî —É–ª—É—á—à–µ–Ω–Ω—ã–π normalize() –∏ matching
- `available_brands.json` ‚Äî –Ω–æ–≤—ã–π —Ä–µ—Å—É—Ä—Å (1063 –±—Ä–µ–Ω–¥–∞)
