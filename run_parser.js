#!/usr/bin/env node

/**
 * –ó–∞–ø—É—Å–∫ —É–ª—É—á—à–µ–Ω–Ω–æ–≥–æ –ø–∞—Ä—Å–µ—Ä–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π
 * 
 * –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
 * node run_parser.js
 * –∏–ª–∏
 * node run_parser.js "—Å—Ç–æ–º–∞—Ç–æ–ª–æ–≥–∏—è" "—Å–∞–Ω–∫—Ç-–ø–µ—Ç–µ—Ä–±—É—Ä–≥" 100
 */

const { runParser } = require('./improved_organization_parser');

async function main() {
    // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ –∏–ª–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    const args = process.argv.slice(2);
    
    const options = {
        niche: args[0] || '—Å—Ç–æ–º–∞—Ç–æ–ª–æ–≥–∏—è',
        city: args[1] || '–º–æ—Å–∫–≤–∞', 
        maxResults: parseInt(args[2]) || 50,
        headless: false // –î–ª—è –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –ª—É—á—à–µ –≤–∏–¥–µ—Ç—å –ø—Ä–æ—Ü–µ—Å—Å
    };
    
    console.log(`
üöÄ –ó–ê–ü–£–°–ö –£–õ–£–ß–®–ï–ù–ù–û–ì–û –ü–ê–†–°–ï–†–ê –û–†–ì–ê–ù–ò–ó–ê–¶–ò–ô
==========================================

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
‚Ä¢ –ù–∏—à–∞: ${options.niche}
‚Ä¢ –ì–æ—Ä–æ–¥: ${options.city}
‚Ä¢ –ú–∞–∫—Å. —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤: ${options.maxResults}
‚Ä¢ –†–µ–∂–∏–º: ${options.headless ? '–°–∫—Ä—ã—Ç—ã–π' : '–í–∏–¥–∏–º—ã–π'}

–î–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:
node run_parser.js "–∞–≤—Ç–æ—Å–µ—Ä–≤–∏—Å" "—Å–ø–±" 100
    `);
    
    try {
        console.log('‚è≥ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...');
        const results = await runParser(options);
        
        console.log(`
‚úÖ –ü–ê–†–°–ò–ù–ì –ó–ê–í–ï–†–®–ï–ù!
===================
üìä –°–æ–±—Ä–∞–Ω–æ: ${results.length} –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π
üìÅ –§–∞–π–ª—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ —Ç–µ–∫—É—â—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
üìà –ü—Ä–æ–≤–µ—Ä—å—Ç–µ CSV —Ñ–∞–π–ª –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö

üéØ –ì–æ—Ç–æ–≤–æ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –≤ Google Sheets!
        `);
        
    } catch (error) {
        console.error(`
‚ùå –û–®–ò–ë–ö–ê –ü–ê–†–°–ò–ù–ì–ê
==================
${error.message}

üîß –í–æ–∑–º–æ–∂–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
2. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —É–º–µ–Ω—å—à–∏—Ç—å maxResults
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –ª–∏ IP
        `);
        
        process.exit(1);
    }
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è
process.on('SIGINT', () => {
    console.log('\\nüõë –ü—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º...');
    process.exit(0);
});

process.on('unhandledRejection', (error) => {
    console.error('üí• –ù–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞:', error);
    process.exit(1);
});

// –ó–∞–ø—É—Å–∫
main();